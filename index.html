<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" type="text/css" href="style.css"/>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css"/>
    <script src="jQuery.js" type="text/javascript"></script>
</head>

<body>
<div id="header">
    KOTERET<br/>
    Hila Kesem Hadad 204706006, Alon Zolfi 205846074
    <p id="logged_user" hidden="true">Hello</p>
</div>
<div id="menu">
    <a id="a_welcome" href="#welcome" class="a_menu w3-bar-item w3-border w3-button w3-red w3-hover-indigo a_menu" >Welcome</a><br/>
    <a id="a_register" href="#register" class="a_menu w3-bar-item w3-border w3-button w3-red w3-hover-indigo a_menu">Register</a><br/>
    <a id="a_login" href="#login" class="a_menu w3-bar-item w3-border w3-button w3-red w3-hover-indigo a_menu">Login</a><br/>
    <a id="a_about" href="#about" class="a_menu w3-bar-item w3-border w3-button w3-red w3-hover-indigo">About</a><br/>
    <script src="jQueryScripts.js" type="text/javascript"></script>
</div>
<div id="content">
    <div id="welcome">
        <button id="b_register" onclick="goTo('register')">Register</button>
        <button id="b_login" onclick="goTo('login')">Login</button>
        <script type="text/javascript">
            function goTo(divName){
                var divs = document.getElementById("content").children;
                for(let item of divs){
                    if(item.id === divName)
                        item.hidden = false;
                    else
                        item.hidden = true;
                }
            }
        </script>
    </div>
    <div id="register" hidden="true">
        <form id="contact_register" method="post" action="">
            <!-- User Name -->
            <div>
                <label for="contact_user_name">User Name:</label>
                <input type="text" id="contact_user_name" name="user_name" class="reg_inp"></input>
                <span class="error">This field is required</span>
            </div>
            <!-- Password -->
            <div>
                <label for="contact_password">Password:</label>
                <input type="password" id="contact_password" name="password" class="reg_inp"></input>
                <span class="error">This field is required</span>
            </div>
            <!-- First Name -->
            <div>
                <label for="contact_first_name">First Name:</label>
                <input type="text" id="contact_first_name" name="first_name" class="reg_inp"></input>
                <span class="error">This field is required</span>
            </div>
            <!-- Last Name -->
            <div>
                <label for="contact_last_name">Last Name:</label>
                <input type="text" id="contact_last_name" name="last_name" class="reg_inp"></input>
                <span class="error">This field is required</span>
            </div>
            <!-- Email -->
            <div>
                <label for="contact_email">Email:</label>
                <input type="email" id="contact_email" name="email" class="reg_inp"></input>
                <span class="error">A valid email address is required</span>
            </div>
            <!-- Birth Date -->
            <div>
                <label for="contact_birthdate">Birth Date:</label>
                <input type="date" id="contact_birthdate" name="birthdate" class="reg_inp"></input>
                <span class="error">This field is required</span>
            </div>
            <!-- Submit Button -->
            <div id="contact_submit_reg">
                <button type="submit">Submit</button>
            </div>
        </form>
        <script type="text/javascript" src="validation.js"></script>
        <script type="text/javascript" src="register_login.js"></script>

    </div>

    <script type="text/javascript">
        function getKeyBoard(input) {
            addEventListener("keydown", function (e) {
                input.val(e.valueOf());
            }, false);
        }
    </script>

    <div id="settings">
        <form id="contact_settings" method="post" action="">
            <!-- right button -->
            <div>
                <label for="contact_right_button">Right Button:</label>
                <input type="text" id="contact_right_button" name="right_button" onclick="getKeyBoard(this)"></input>
                <span class="error">This field is required</span>
            </div>
            <!-- left button -->
            <div>
                <label for="contact_left_button">Left Button:</label>
                <input type="text" id="contact_left_button" name="left_button" onclick="getKeyBoard(this)"></input>
                <span class="error">This field is required</span>
            </div>
            <!-- up button -->
            <div>
                <label for="contact_up_button">Up Button:</label>
                <input type="text" id="contact_up_button" name="up_button" onclick="getKeyBoard(this)"></input>
                <span class="error">This field is required</span>
            </div>
            <!-- down button -->
            <div>
                <label for="contact_down_button">Down Button:</label>
                <input type="text" id="contact_down_button" name="down_button" onclick="getKeyBoard(this)"></input>
                <span class="error">This field is required</span>
            </div>
            <!-- number of food -->
            <div>
                <label for="contact_food">Food Amount:</label>
                <input type="number" max="90" min="50" id="contact_food" name="food"></input>
                <span class="error">This field is required</span>
            </div>
            <!-- color of 5 points -->
            <div>
                <label for="contact_5_points">5 Points Food color:</label>
                <input type="color" id="contact_5_points" name="5_points"></input>
                <span class="error">This field is required</span>
            </div>
            <!-- color of 15 points -->
            <div>
                <label for="contact_15_points">15 Points Food color:</label>
                <input type="color" id="contact_15_points" name="15_points"></input>
                <span class="error">This field is required</span>
            </div>
            <!-- color of 25 points -->
            <div>
                <label for="contact_25_points">25 Points Food color:</label>
                <input type="color" id="contact_25_points" name="25_points"></input>
                <span class="error">This field is required</span>
            </div>
            <!-- time to play -->
            <div>
                <label for="contact_play_time">Time To Play:</label>
                <input type="number" min="60" id="contact_play_time" name="play_time"></input>
                <span class="error">This field is required</span>
            </div>
            <!-- number of monsters -->
            <div>
                <label for="contact_monsters">Monsters Amount:</label>
                <input type="number" max="3" min="1" id="contact_monsters" name="monsters"></input>
                <span class="error">This field is required</span>
            </div>
            <!-- Submit Button -->
            <div id="contact_submit_set">
                <button type="submit">Submit</button>
            </div>
            <!-- Random Button -->
            <div id="contact_random">
                <button type="submit">Random</button>
            </div>
        </form>
        <script type="text/javascript" src="settings.js"></script>
    </div>


    <div id="login" hidden="true">
        <form id="login_form" onsubmit="logIn()">
            User name:</br>
            <input id="username_login" type="text" name="userName" class="login_input"/><br>
            Password:</br>
            <input id="password_login" type="password" name="password" class="login_input"/><br>
            <input type="submit" value="Log in" onclick="logIn(); return false;"/>
        </form>
    </div>

    <div id="game" hidden="true">
        SCORE:
        <input id="lblScore" type="text"/>
        TIME:
        <input id="lblTime" type="text"/>
        <br />
        <canvas id="canvas" height="720" width="720"></canvas>

        <script type="text/javascript">
            var context = canvas.getContext("2d");
            var shape = new Object();
            var board;
            var score;
            var pac_color;
            var start_time;
            var time_elapsed;
            var interval;
            var right;
            var left;
            var up;
            var down;
            var food;
            var points5;
            var points15;
            var points25;
            var time;
            var monsters;

            function set() {
                right=$("#contact_right_button").valueOf();
                left=$("#contact_left_button").valueOf();
                up=$("#contact_up_button").valueOf();
                down=$("#contact_down_button").valueOf();
                food=$("#contact_food").valueOf();
                points5=$("#contact_5_points").valueOf();
                points15=$("#contact_15_points").valueOf();
                points25=$("#contact_25_points").valueOf();
                time=$("#contact_play_time").valueOf();
                monsters=$("#contact_monsters").valueOf();
            }

            Start();

            function Start() {
                board = new Array();
                score = 0;
                pac_color = "yellow";
                var cnt = 144;
                var food_remain = food;
                var pacman_remain = 1;
                start_time = new Date();
                for (var i = 0; i < 12; i++) {
                    board[i] = new Array();
                    for (var j = 0; j < 12; j++) {
                        var x = Math.random();
                        if (i == 0 || j==0 || i==11 ||j==11|| x <= 0.10 ) {
                            board[i][j] = 4;
                        } else {
                            var randomNum = Math.random();
                            if (randomNum <= 1.0 * food_remain / cnt) {
                                food_remain--;
                                board[i][j] = 1;
                            } else if (randomNum < 1.0 * (pacman_remain + food_remain) / cnt) {
                                shape.i = i;
                                shape.j = j;
                                pacman_remain--;
                                board[i][j] = 2;
                            } else {
                                board[i][j] = 0;
                            }
                            cnt--;
                        }
                    }
                }
                while (food_remain > 0) {
                    var emptyCell = findRandomEmptyCell(board);
                    board[emptyCell[0]][emptyCell[1]] = 1;
                    food_remain--;
                }
                keysDown = {};
                addEventListener("keydown", function (e) {
                    keysDown[e.code] = true;
                }, false);
                addEventListener("keyup", function (e) {
                    keysDown[e.code] = false;
                }, false);
                interval = setInterval(UpdatePosition, 250);
            }


            function findRandomEmptyCell(board) {
                var i = Math.floor((Math.random() * 11) + 1);
                var j = Math.floor((Math.random() * 11) + 1);
                while (board[i][j] !== 0) {
                    i = Math.floor((Math.random() * 11) + 1);
                    j = Math.floor((Math.random() * 11) + 1);
                }
                return [i, j];
            }

            /**
             * @return {number}
             */
            function GetKeyPressed() {
                if (keysDown[up]) {
                    return 1;
                }
                if (keysDown[down]) {
                    return 2;
                }
                if (keysDown[left]) {
                    return 3;
                }
                if (keysDown[right]) {
                    return 4;
                }
            }

            function Draw() {
                context.clearRect(0, 0, canvas.width, canvas.height); //clean board
                lblScore.value = score;
                lblTime.value = time_elapsed;
                for (var i = 0; i < 12; i++) {
                    for (var j = 0; j < 12; j++) {
                        var center = new Object();
                        center.x = i * 60 + 30;
                        center.y = j * 60 + 30;
                        if (board[i][j] === 2) {
                            context.beginPath();
                            context.arc(center.x, center.y, 30, 0.15 * Math.PI, 1.85 * Math.PI); // half circle
                            context.lineTo(center.x, center.y);
                            context.fillStyle = pac_color; //color
                            context.fill();
                            context.beginPath();
                            context.arc(center.x + 5, center.y - 15, 5, 0, 2 * Math.PI); // circle
                            context.fillStyle = "black"; //color
                            context.fill();
                        } else if (board[i][j] === 1) {
                            context.beginPath();
                            context.arc(center.x, center.y, 15, 0, 2 * Math.PI); // circle
                            context.fillStyle = "black"; //color
                            context.fill();
                        } else if (board[i][j] === 4) {
                            context.beginPath();
                            context.rect(center.x - 30, center.y - 30, 60, 60);
                            context.fillStyle = "grey"; //color
                            context.fill();
                        }
                    }
                }


            }

            function UpdatePosition() {
                board[shape.i][shape.j] = 0;
                var x = GetKeyPressed();
                if (x === 1) {
                    if (shape.j > 0 && board[shape.i][shape.j - 1] !== 4) {
                        shape.j--;
                    }
                }
                if (x === 2) {
                    if (shape.j < 11 && board[shape.i][shape.j + 1] !== 4) {
                        shape.j++;
                    }
                }
                if (x === 3) {
                    if (shape.i > 0 && board[shape.i - 1][shape.j] !== 4) {
                        shape.i--;
                    }
                }
                if (x === 4) {
                    if (shape.i < 11 && board[shape.i + 1][shape.j] !== 4) {
                        shape.i++;
                    }
                }
                if (board[shape.i][shape.j] === 1) {
                    score++;
                }
                board[shape.i][shape.j] = 2;
                var currentTime = new Date();
                time_elapsed = (currentTime - start_time) / 1000;
                if (score >= 20 && time_elapsed <= 10) {
                    pac_color = "green";
                }
                if (score === 50) {
                    window.clearInterval(interval);
                    window.alert("Game completed");
                } else {
                    Draw();
                }
            }
        </script>

    </div>


</div>
<div id="footer"></div>
</body>

</html>